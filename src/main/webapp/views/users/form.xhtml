<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    template="/templates/template.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

  <!-- Metadatos para cargar en edici√≥n -->
  <f:metadata>
    <f:viewParam name="id"
                 value="#{userBean.usuario.id_usuario}"
                 converter="jakarta.faces.Long" />
    <f:event type="preRenderView"
             listener="#{userBean.loadUsuario}" />
  </f:metadata>

  <ui:define name="titulo">üìù Registro / Edici√≥n de Usuario</ui:define>
  <ui:define name="contenido">
    <h:form styleClass="form-card" prependId="false">
      <h:messages globalOnly="true" styleClass="alert alert-error"/>

      <!-- Nombre -->
      <div class="form-group">
        <h:outputLabel for="nombre" value="üë§ Nombre:" styleClass="form-label"/>
        <h:inputText id="nombre"
                     value="#{userBean.usuario.nombre}"
                     required="true"
                     requiredMessage="El nombre es obligatorio"
                     styleClass="form-control"/>
        <h:message for="nombre" styleClass="error-message"/>
      </div>

      <!-- Apellido -->
      <div class="form-group">
        <h:outputLabel for="apellido" value="üë• Apellido:" styleClass="form-label"/>
        <h:inputText id="apellido"
                     value="#{userBean.usuario.apellido}"
                     required="true"
                     requiredMessage="El apellido es obligatorio"
                     styleClass="form-control"/>
        <h:message for="apellido" styleClass="error-message"/>
      </div>

      <!-- Tel√©fono -->
      <div class="form-group">
        <h:outputLabel for="telefono" value="üìû Tel√©fono:" styleClass="form-label"/>
        <h:inputText id="telefono"
                     value="#{userBean.usuario.telefono}"
                     styleClass="form-control"/>
        <h:message for="telefono" styleClass="error-message"/>
      </div>

      <!-- Direcci√≥n -->
      <div class="form-group">
        <h:outputLabel for="direccion" value="üè† Direcci√≥n:" styleClass="form-label"/>
        <h:inputText id="direccion"
                     value="#{userBean.usuario.direccion}"
                     styleClass="form-control"/>
        <h:message for="direccion" styleClass="error-message"/>
      </div>

      <!-- Email -->
      <div class="form-group">
        <h:outputLabel for="email" value="üìß Correo Electr√≥nico:" styleClass="form-label"/>
        <h:inputText id="email"
                     value="#{userBean.usuario.email}"
                     required="true"
                     requiredMessage="El email es obligatorio"
                     styleClass="form-control"/>
        <h:message for="email" styleClass="error-message"/>
      </div>

      <!-- Username -->
      <div class="form-group">
        <h:outputLabel for="username" value="üîë Usuario:" styleClass="form-label"/>
        <h:inputText id="username"
                     value="#{userBean.usuario.username}"
                     required="true"
                     requiredMessage="El usuario es obligatorio"
                     styleClass="form-control"/>
        <h:message for="username" styleClass="error-message"/>
      </div>

      <!-- Password -->
      <div class="form-group">
        <h:outputLabel for="password" value="üîí Contrase√±a:" styleClass="form-label"/>
        <h:inputSecret id="password"
                       value="#{userBean.usuario.password}"
                       required="true"
                       requiredMessage="La contrase√±a es obligatoria"
                       styleClass="form-control"/>
        <h:message for="password" styleClass="error-message"/>
      </div>

      <!-- Rol -->
      <div class="form-group">
        <h:outputLabel for="rol" value="üë• Rol:" styleClass="form-label"/>
        <h:selectOneMenu id="rol"
                         value="#{userBean.usuario.rol}"
                         required="true"
                         requiredMessage="Debe seleccionar un rol"
                         styleClass="form-control">
          <f:selectItem itemLabel="-- Seleccione un rol --" itemValue=""/>
          <f:selectItem itemLabel="USER" itemValue="USER"/>
          <f:selectItem itemLabel="ADMIN" itemValue="ADMIN"/>
        </h:selectOneMenu>
        <h:message for="rol" styleClass="error-message"/>
      </div>

      <!-- Botones -->
      <div class="form-actions">
        <h:commandButton value="‚ûï Agregar Usuario"
                         action="#{userBean.agregarUsuario}"
                         rendered="#{userBean.usuario.id_usuario == null}"
                         styleClass="btn btn-primary"/>
        <h:commandButton value="‚úèÔ∏è Modificar Usuario"
                         action="#{userBean.modificarUsuario}"
                         rendered="#{userBean.usuario.id_usuario != null}"
                         styleClass="btn btn-primary"/>
        <h:commandButton value="‚ùå Cancelar"
                         action="/views/users/list.xhtml?faces-redirect=true"
                         immediate="true"
                         styleClass="btn btn-secondary"/>
      </div>
    </h:form>
  </ui:define>
</ui:composition>
